!function(){"use strict";jQuery(document).ready((function(e){var o={appendStoreCreditRefundButton:function(){e("#acfw-refund-as-store-credits").length||(e("#post-body .refund-actions").prepend('<button type="button" id="acfw-refund-as-store-credits" class="button button-primary">'+acfwEditOrder.button_text+"</button>"),e("#post-body button.refund-items").on("click",o.appendStoreCreditRefundButton))},refundAmountChanged:function(){var o=accounting.unformat(e(this).val(),woocommerce_admin.mon_decimal_point);e("button#acfw-refund-as-store-credits .amount").text(accounting.formatMoney(o,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},doRefund:function(){if(o.blockMetabox(),window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)){var t=e("input#refund_amount").val(),r=e("input#refund_reason").val(),n=e("input#refunded_amount").val(),a={},d={},c={};e(".refund input.refund_order_item_qty").each((function(o,t){e(t).closest("tr").data("order_item_id")&&e(t).val()&&(a[e(t).closest("tr").data("order_item_id")]=e(t).val())})),e(".refund input.refund_line_total").each((function(o,t){e(t).closest("tr").data("order_item_id")&&(d[e(t).closest("tr").data("order_item_id")]=accounting.unformat(e(t).val(),woocommerce_admin.mon_decimal_point))})),e(".refund input.refund_line_tax").each((function(o,t){if(e(t).closest("tr").data("order_item_id")){var r=e(t).data("tax_id");c[e(t).closest("tr").data("order_item_id")]||(c[e(t).closest("tr").data("order_item_id")]={}),c[e(t).closest("tr").data("order_item_id")][r]=accounting.unformat(e(t).val(),woocommerce_admin.mon_decimal_point)}}));var i={action:"woocommerce_refund_line_items",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:t,refunded_amount:n,refund_reason:r,line_item_qtys:JSON.stringify(a,null,""),line_item_totals:JSON.stringify(d,null,""),line_item_tax_totals:JSON.stringify(c,null,""),api_refund:e(this).is(".do-api-refund"),restock_refunded_items:e("#restock_refunded_items:checked").length?"true":"false",security:woocommerce_admin_meta_boxes.order_item_nonce,acfw_store_credits:!0};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(t){!0===t.success?window.location.reload():(window.alert(t.data.error),e("#woocommerce-order-items").trigger("wc_order_items_reload"),o.unblockMetabox())},complete:function(){window.wcTracks.recordEvent("order_edit_refunded",{order_id:i.order_id,status:e("#order_status").val(),api_refund:i.api_refund,has_reason:!!i.refund_reason,restock:"true"===i.restock_refunded_items})}})}else o.unblockMetabox()},blockMetabox:function(){e("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblockMetabox:function(){e("#woocommerce-order-items").unblock()},movePaymentSummaryBelowOrderTotals:function(){e(".wc-order-totals-items .wc-order-totals tr.acfw-payment-row").length&&(e(".wc-order-totals-items .wc-order-totals tr.acfw-payment-row").appendTo(".wc-order-totals-items .wc-order-totals:first-child tbody"),e(".wc-order-totals-items .wc-order-totals tr.acfw-payment-row").removeClass("acfw-payment-row"),e(".wc-order-totals-items table.wc-order-totals").length>2&&e(e(".wc-order-totals-items table.wc-order-totals")[1]).remove())},applyStoreCreditsToOrder:function(){e(this);var t=window.prompt(acfwEditOrder.apply_store_credits_prompt,acfwEditOrder.order_store_credits_amount);null!==t&&(o.blockMetabox(),e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:{action:"acfwf_apply_store_credits_to_order",order_id:woocommerce_admin_meta_boxes.post_id,amount:t,security:woocommerce_admin_meta_boxes.order_item_nonce},type:"POST",success:function(e){!0===e.success?window.location.reload():window.alert(e.data.error),o.unblockMetabox()}}))},disallowDeleteStoreCreditCoupon:function(){e("ul.wc_coupon_list li span span:contains('"+acfwEditOrder.store_credit_coupon_code+"')").closest(".code").removeClass("editable").find("a.remove-coupon").remove()},init:function(){e("#woocommerce-order-items").on("click","button.refund-items",o.appendStoreCreditRefundButton),e("#woocommerce-order-items").on("change keyup",".wc-order-refund-items #refund_amount",o.refundAmountChanged),e("body").on("click","button#acfw-refund-as-store-credits",o.doRefund),e("body").on("order-totals-recalculate-complete",o.movePaymentSummaryBelowOrderTotals),e("body").on("click","button.acfw-apply-store-credits",o.applyStoreCreditsToOrder)}};o.movePaymentSummaryBelowOrderTotals(),o.disallowDeleteStoreCreditCoupon(),o.init()}))}();
//# sourceMappingURL=acfwf-edit-order.js.map