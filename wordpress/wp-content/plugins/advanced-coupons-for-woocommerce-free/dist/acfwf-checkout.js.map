{"version":3,"file":"acfwf-checkout.js","mappings":"yBACAA,QAAO,SAAUC,GACb,IAAIC,EAAQ,CACRC,YAAa,WAETF,EAAE,sCAAsCG,aAAa,CACjDC,UAAW,cACXC,QAAS,QACTC,IAAK,kCACLC,MAAO,IACPC,UAAU,EACVC,UAAW,MACXC,SAAS,EACTC,OAAQ,SAAUC,GACdA,EAASC,KAAK,eAAeC,OACjC,GAER,EACAC,mBAAoB,WAChB,IAAIC,EAAUhB,EAAEiB,MACZC,EAASF,EAAQG,SAAS,oBAC1BC,EAAQJ,EAAQK,QAAQ,mCACxBC,EAASrB,EAAMsB,WAAWL,EAAOM,OACrCJ,EAAMP,KAAK,qBAAqBY,SAChCzB,EAAE,8CAA8CyB,SAC3CxB,EAAMyB,cAAcJ,IAIzBK,cAAcC,UACd3B,EAAM4B,gBACN7B,EAAE8B,KAAKC,mBAAmBC,SAAU,CAChCC,OAAQ,6BACRX,OAAQA,EACRY,QAASC,cAAcC,eACxB,SAAUC,GACTpC,EAAMqC,kBACNpB,EAAOM,IAAI,IACXxB,EAAEuC,SAASC,MAAMnC,QAAQ,kBAAmB,CACxCoC,wBAAwB,GAEhC,KAfIrB,EAAMsB,OAAO,8BAAgCP,cAAcQ,kBAAoB,OAgBvF,EACAjB,cAAe,SAAUkB,GACrBA,EAAQA,EAAMC,WACd,IAAIC,EAAQ,IAAIC,OAAO,eAAgB,MACnCC,EAAe,IAAID,OAAO,WAAa,MACvCE,EAAWL,EAAMM,QAAQJ,EAAO,IAKpC,OAHI,EAAIG,EAASC,QAAQF,EAAc,IAAIG,SACvCF,EAAWA,EAASC,QAAQF,EAAc,KAEvCI,WAAWR,KAAWQ,WAAWH,EAC5C,EACA1B,WAAY,SAAUqB,GAClB,OAAOA,EACDQ,WAAWR,EAAMM,QAAQf,cAAckB,mBAAoB,IAAIH,QAAQf,cAAcmB,kBAAmB,MACxG,CACV,EACAzB,cAAe,WACX7B,EAAE,0CACGuD,SAAS,cAETC,MAAM,CACPC,QAAS,KACTC,WAAY,CACRC,WAAY,OACZC,QAAS,KAGrB,EACAtB,gBAAiB,WACbtC,EAAE,4CAA4CyB,SAE9CzB,EAAE,0CAA0C6D,YAAY,cAAcC,SAC1E,EACAC,yBAA0B,SAAUC,GAChCA,EAAEC,kBACFtC,cAAcuC,KAAK,sCACnBlE,EAAE,cAAcmE,QAAQ,CAEpBC,UAAWpE,EAAE,qBAAqBqE,SAASC,IAAM,KAClD,IACP,EACAC,KAAM,WACFvE,EAAEuC,SAASC,MAAMgC,GAAG,mBAAoBvD,KAAKf,aAC7CF,EAAEuC,SAASC,MAAMgC,GAAG,QAAS,0CAA2CvD,KAAKF,oBAC7Ef,EAAEuC,SAASC,MAAMgC,GAAG,QAAS,yCAA0CvD,KAAK8C,yBAChF,GAEJ9D,EAAMsE,MACV,G","sources":["webpack://advanced-coupons-free/./packages/acfwf-checkout/index.ts"],"sourcesContent":["import './index.scss';\r\njQuery(function ($) {\r\n    var Funcs = {\r\n        initPopover: function () {\r\n            // @ts-ignore\r\n            $('#acfw-apply-store-credits-discount').webuiPopover({\r\n                placement: 'bottom-left',\r\n                trigger: 'click',\r\n                url: '#acfw-store-credits-redeem-form',\r\n                width: 250,\r\n                closable: true,\r\n                animation: 'pop',\r\n                padding: false,\r\n                onShow: function ($element) {\r\n                    $element.find('.input-text').focus();\r\n                },\r\n            });\r\n        },\r\n        redeemStoreCredits: function () {\r\n            var $button = $(this);\r\n            var $input = $button.siblings('input.input-text');\r\n            var $form = $button.closest('#acfw-store-credits-redeem-form');\r\n            var amount = Funcs.parsePrice($input.val());\r\n            $form.find('p.invalid-message').remove();\r\n            $('.woocommerce-NoticeGroup-updateOrderReview').remove();\r\n            if (!Funcs.validatePrice(amount)) {\r\n                $form.append(\"<p class='invalid-message'>\" + acfwfCheckout.enter_valid_price + '</p>');\r\n                return;\r\n            }\r\n            WebuiPopovers.hideAll();\r\n            Funcs.blockCheckout();\r\n            $.post(wc_checkout_params.ajax_url, {\r\n                action: 'acfwf_redeem_store_credits',\r\n                amount: amount,\r\n                wpnonce: acfwfCheckout.redeem_nonce,\r\n            }, function (response) {\r\n                Funcs.unblockCheckout();\r\n                $input.val('');\r\n                $(document.body).trigger('update_checkout', {\r\n                    update_shipping_method: false,\r\n                });\r\n            });\r\n        },\r\n        validatePrice: function (value) {\r\n            value = value.toString();\r\n            var regex = new RegExp(\"[^-0-9%\\\\.]+\", 'gi');\r\n            var decimalRegex = new RegExp(\"[^\\\\.}\\\"]\", 'gi');\r\n            var newvalue = value.replace(regex, '');\r\n            // Check if newvalue have more than one decimal point.\r\n            if (1 < newvalue.replace(decimalRegex, '').length) {\r\n                newvalue = newvalue.replace(decimalRegex, '');\r\n            }\r\n            return parseFloat(value) === parseFloat(newvalue);\r\n        },\r\n        parsePrice: function (value) {\r\n            return value\r\n                ? parseFloat(value.replace(acfwfCheckout.thousand_separator, '').replace(acfwfCheckout.decimal_separator, '.'))\r\n                : 0;\r\n        },\r\n        blockCheckout: function () {\r\n            $('.woocommerce form.woocommerce-checkout')\r\n                .addClass('processing')\r\n                // @ts-ignore\r\n                .block({\r\n                message: null,\r\n                overlayCSS: {\r\n                    background: '#fff',\r\n                    opacity: 0.6,\r\n                },\r\n            });\r\n        },\r\n        unblockCheckout: function () {\r\n            $('.woocommerce-error, .woocommerce-message').remove();\r\n            // @ts-ignore\r\n            $('.woocommerce form.woocommerce-checkout').removeClass('processing').unblock();\r\n        },\r\n        reapplyDiscountViaNotice: function (e) {\r\n            e.stopPropagation();\r\n            WebuiPopovers.show('#acfw-apply-store-credits-discount');\r\n            $('html, body').animate({\r\n                // @ts-ignore\r\n                scrollTop: $('.webui-popover.in').offset().top - 200,\r\n            }, 1000);\r\n        },\r\n        init: function () {\r\n            $(document.body).on('updated_checkout', this.initPopover);\r\n            $(document.body).on('click', '#acfw-store-credits-redeem-form .button', this.redeemStoreCredits);\r\n            $(document.body).on('click', '.woocommerce .acfw-reapply-sc-discount', this.reapplyDiscountViaNotice);\r\n        },\r\n    };\r\n    Funcs.init();\r\n});\r\n"],"names":["jQuery","$","Funcs","initPopover","webuiPopover","placement","trigger","url","width","closable","animation","padding","onShow","$element","find","focus","redeemStoreCredits","$button","this","$input","siblings","$form","closest","amount","parsePrice","val","remove","validatePrice","WebuiPopovers","hideAll","blockCheckout","post","wc_checkout_params","ajax_url","action","wpnonce","acfwfCheckout","redeem_nonce","response","unblockCheckout","document","body","update_shipping_method","append","enter_valid_price","value","toString","regex","RegExp","decimalRegex","newvalue","replace","length","parseFloat","thousand_separator","decimal_separator","addClass","block","message","overlayCSS","background","opacity","removeClass","unblock","reapplyDiscountViaNotice","e","stopPropagation","show","animate","scrollTop","offset","top","init","on"],"sourceRoot":""}