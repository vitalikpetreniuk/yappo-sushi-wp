!function(){"use strict";function e(e,t,n,r,s,o,i){try{var a=e[o](i),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,s)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(s,o){var i=t.apply(n,r);function a(t){e(i,s,o,a,c,"next",t)}function c(t){e(i,s,o,a,c,"throw",t)}a(void 0)}))}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function s(e,t,n,r){var s,o,i,a,c=!1,l=!1,u={},g=0,d=0,p={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(e){s=e.clientX,o=e.clientY}function w(e,t){if(d&&(d=clearTimeout(d)),Math.abs(i-s)+Math.abs(a-o)<p.sensitivity)return g=1,l?void 0:n(e,t);i=s,a=o,d=setTimeout((function(){w(e,t)}),p.interval)}function f(e,t){return c=!0,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1!==g&&(i=t.clientX,a=t.clientY,e.addEventListener("mousemove",h,!1),d=setTimeout((function(){w(e,t)}),p.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function b(e,t){return c=!1,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1===g&&(d=setTimeout((function(){!function(e,t){d&&(d=clearTimeout(d)),g=0,l||r(e,t)}(e,t)}),p.timeout)),this}function v(e){e.target.matches(t+", "+t+" *")&&b(e.target.closest(t),e)}function y(e){var r,s;e.target.matches(t+", "+t+" *")&&(r=e.target.closest(t),s=e,c||(l=!0,n(r,s)))}function k(e){var n,s;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),s=e,!c&&l&&(l=!1,r(n,s)))}function S(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",k,!1)}return u.options=function(t){var n=t.handleFocus!==p.handleFocus;return p=Object.assign({},p,t),n&&(p.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",k,!1)):S()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",v,!1),S())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",v,!1)),u}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var o=function(e){var t={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:10,retryOnErrors:[401,403,404,429,502,503,504],performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),t.retry.performingRequest=!0,0===t.retry.currentDelay&&(t.retry.currentDelay=1e3,t.retry.count=1),t.retry.currentDelay+=500*t.retry.count*e,t.retry.count++},canRetry:function(){return t.retry.count<t.retry.max},reset:function(){t.retry.currentDelay=0,t.retry.count=0,t.retry.performingRequest=!1}},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},listenTooltip:function(){s(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="hidden"}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup centered-modal":"wpstg-swal-popup"},r={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(r)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?t.cache.get(".wpstg-loader").show():t.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},showAjaxFatalError:function(e,n,r){return n=n?n+"<br/><br/>":"Something went wrong! <br/><br/>",r=r?r+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(t.showError(n+" Error: No response."+r),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(t.showError(n+" Error: "+e.message+r),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(e){return e.ok||t.showError("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},showError:function(n){t.retry.performingRequest||(t.cache.get("#wpstg-try-again").css("display","inline-block"),t.cache.get("#wpstg-cancel-cloning").text("Reset"),t.cache.get("#wpstg-resume-cloning").show(),t.cache.get("#wpstg-error-wrapper").show(),t.cache.get("#wpstg-error-details").show().html(n),t.cache.get("#wpstg-removing-clone").removeClass("loading"),t.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(n))},resetErrors:function(){t.cache.get("#wpstg-error-details").hide().html("")},ajax:function(n,r,s,o,i,a,c){void 0===a&&(a=null),void 0===c&&(c=null),void 0===s&&(s="json"),!1!==o&&(o=!0);var l=10,u=1e4*(i=void 0===i?0:i);a=parseInt(a),isNaN(a)||(u*=a),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:s,cache:!1,data:n,error:function(e,g,d){if(console.log(e.status+" "+e.statusText+"---"+g),"function"!=typeof c||(c(e,g,d),t.continueErrorHandle))if(++i<=l)setTimeout((function(){t.ajax(n,r,s,o,i,a)}),u);else{var p=void 0===e.status?"Unknown":e.status;t.showError("Fatal Error:  "+p+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}else t.continueErrorHandle=!0},success:function(e){"function"==typeof r&&r(e)},statusCode:{404:function(){i>=l&&t.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){i>=l&&t.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){i>l&&t.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){i>=l&&t.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){i>=l&&t.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){i>=l&&t.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){i>=l&&t.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})}};return t}(jQuery);function i(e){return document.querySelector(e)}function a(e,t,n,r){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&r(e.target.closest(n),e)}),!1)}function c(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function l(e,t){for(var n=[],r=e&&e.parentElement;r;r=r.parentElement)r.matches(t)&&n.push(r);return n}var u=function(){function e(e,t,n,r){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t=".wpstg-edit-clone-db-inputs"),void 0===n&&(n=wpstg),void 0===r&&(r="wpstg_database_connect"),this.workflow=i(e),this.dbCheckTriggerClass=t,this.wpstgObject=n,this.databaseCheckAction=r,this.dbCheckTimer=null,this.abortDbCheckController=null,this.dbCheckCallStatus=!1,this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1},{type:"error",background:"#e01e5a",duration:2e3,dismissible:!0}]}),this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.workflow&&["paste","input"].forEach((function(t){a(e.workflow,t,e.dbCheckTriggerClass,(function(){!0===e.dbCheckCallStatus&&(e.abortDbCheckController.abort(),e.abortDbCheckController=null,e.dbCheckCallStatus=!1),clearTimeout(e.dbCheckTimer),e.dbCheckTimer=setTimeout((function(){e.checkDatabase()}),300)}))}))},t.init=function(){this.addEvents()},t.checkDatabase=function(){var e=this,t="#wpstg-edit-clone-data-",n=i(t+"database-user").value,r=i(t+"database-password").value,s=i(t+"database-database").value,o=i(t+"database-server").value,a=i(t+"database-prefix").value,c=i(t+"database-ssl").checked;""!==n||""!==r||""!==s||""!==a?(this.abortDbCheckController=new AbortController,this.dbCheckCallStatus=!0,fetch(this.wpstgObject.ajaxUrl,{method:"POST",signal:this.abortDbCheckController.signal,credentials:"same-origin",body:new URLSearchParams({action:this.databaseCheckAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,databaseUser:n,databasePassword:r,databaseServer:o,databaseDatabase:s,databasePrefix:a,databaseSsl:c,databaseEnsurePrefixTableExist:!0}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return e.dbCheckCallStatus=!1,t.ok?t.json():Promise.reject(t)})).then((function(t){return e.notyf.dismissAll(),!1===t?(e.notyf.error(e.wpstgObject.i18n.dbConnectionFailed),void(i("#wpstg-save-clone-data").disabled=!0)):void 0!==t.errors&&t.errors&&void 0!==t.success&&"false"===t.success?(e.notyf.error(e.wpstgObject.i18n.dbConnectionFailed+"! <br/> Error: "+t.errors),void(i("#wpstg-save-clone-data").disabled=!0)):void 0!==t.errors&&t.errors&&void 0!==t.success&&"true"===t.success?(e.notyf.open({type:"warning",message:"Warning: "+t.errors}),void(i("#wpstg-save-clone-data").disabled=!0)):void(void 0!==t.success&&t.success&&(e.notyf.success(e.wpstgObject.i18n.dbConnectionSuccess),i("#wpstg-save-clone-data").disabled=!1))})).catch((function(t){e.dbCheckCallStatus=!1,console.warn(e.wpstgObject.i18n.somethingWentWrong,t),i("#wpstg-save-clone-data").disabled=!0}))):i("#wpstg-save-clone-data").disabled=!1},e}(),g=function(){function e(e,t,n){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg_select_tables_pushing"),void 0===n&&(n=wpstg),this.workflow=i(e),this.inputSelector=t,this.input=i(t),this.wpstgObject=n,this.cloneID=this.input.getAttribute("data-clone"),this.tablePrefix=this.input.getAttribute("data-prefix"),this.isNetwork="true"===this.input.getAttribute("data-network"),this.areAllTablesChecked=!0,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;a(document.body,"click",".wpstg-button-show-tables",(function(t){e.showAllTables()})),a(document.body,"click",".wpstg-button-db-prefix",(function(){e.selectDefaultTables()})),a(document.body,"click",".wpstg-button-unselect",(function(){e.toggleTableSelection()})),a(document.body,"change",this.inputSelector,(function(){e.countSelectedTables()}))},t.init=function(){this.addEvents()},t.showAllTables=function(){var e=this,t=this.getIncludedTables(),n=this.getExcludedTables();t.length>n.length?t="":n.length>t.length&&(n=""),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_push_tables",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,includedTables:t,excludedTables:n,selectedTablesWithoutPrefix:this.getSelectedTablesWithoutPrefix()}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(void 0!==t.success&&t.success)return e.input.innerHTML=t.content,n=i(".wpstg-button-show-tables"),void 0===(r=300)&&(r=300),n.style.opacity=1,n.style.transitionProperty="opacity",n.style.transitionDuration=r+"ms",setTimeout((function(){n.style.opacity=0,window.setTimeout((function(){n.style.display="none",n.style.removeProperty("opacity"),n.style.removeProperty("transition-duration"),n.style.removeProperty("transition-property")}),r)}),0),void e.countSelectedTables();var n,r;void 0===t.message?e.notyf.error(e.wpstgObject.i18n.somethingWentWrong):e.notyf.error(t.message)})).catch((function(t){console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},t.getRegexPattern=function(){var e="^"+this.tablePrefix;return"1"!==this.wpstgObject.isMultisite||this.isNetwork||(e+="([^0-9])_*"),e},t.selectDefaultTables=function(){var e=this.input.querySelectorAll(".wpstg-db-table"),t=this.getRegexPattern();e.forEach((function(e){e.getAttribute("name","").match(t)?e.selected=!0:e.selected=!1})),this.countSelectedTables()},t.toggleTableSelection=function(){!1===this.areAllTablesChecked?(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!0})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.areAllTablesChecked=!0):(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!1})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.areAllTablesChecked=!1),this.countSelectedTables()},t.getSelectedTablesWithoutPrefix=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var r=n.getAttribute("name","");r.match(t)||e.push(r)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getIncludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var r=n.getAttribute("name","");r.match(t)&&e.push(r)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getExcludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:not(:checked)").forEach((function(n){var r=n.getAttribute("name","");r.match(t)&&e.push(r)})),e.join(this.wpstgObject.settings.directorySeparator)},t.countSelectedTables=function(){var e=this.input.querySelectorAll("option:checked").length,t=i("#wpstg-tables-count");0===e?(t.classList.add("danger"),t.innerHTML=this.wpstgObject.i18n.noTableSelected):(t.classList.remove("danger"),t.innerHTML=this.wpstgObject.i18n.tablesSelected.replace("{d}",e))},e}(),d=function(){function e(e,t,n,r){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg-scanning-files"),void 0===n&&(n=".wpstg-check-dir"),void 0===r&&(r=wpstg),this.workflow=i(e),this.filesTabSelector=t,this.filesTab=i(t),this.dirSelector=n,this.wpstgObject=r,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;a(this.workflow,"change",this.filesTabSelector+" "+this.dirSelector,(function(t){e.toggleChildren(t),e.countSelectedFiles()}))},t.init=function(){this.addEvents()},t.toggleChildren=function(e){l(e,".wpstg-dir")[0].querySelectorAll(".wpstg-subdir>.wpstg-dir>"+this.dirSelector).forEach((function(t){t.checked=e.checked}))},t.countSelectedFiles=function(){var e=this,t=this.filesTab.querySelectorAll(this.dirSelector+":checked").length,n=i("#wpstg-files-count");if(0===t)n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.noFileSelected;else{var r=0,s=0;n.classList.remove("danger"),this.filesTab.querySelectorAll(".wpstg-dir:not(.wpstg-sub-dir)>.wpstg-push-expand-dirs").forEach((function(t){"plugins"===t.innerHTML&&(s=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length),"themes"===t.innerHTML&&(r=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length)})),n.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",r).replace("{p}",s)}},e}(),p=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e}var t=e.prototype;return t.showModal=function(){return this.loadModal()},t.loadModal=function(){return o.getSwalModal(!1,{container:"wpstg-swal2-container wpstg-swal2-loading wpstg-swal2-loading-sm"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"100px",focusConfirm:!1,showConfirmButton:!1,showCancelButton:!1})},t.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><img src="'+this.wpstgObject.wpstgIcon+'" /></div>'},e}(),h=function(){function e(e,t,n,r,s,o,a,c,l,u,g,d,p){void 0===e&&(e="#wpstg-btn-provider-revoke"),void 0===t&&(t="#wpstg-provider-revoke-form"),void 0===n&&(n="wpstg-provider-revoke"),void 0===r&&(r="#wpstg-btn-save-provider-settings"),void 0===s&&(s="#wpstg-provider-settings-form"),void 0===o&&(o="wpstg-provider-settings"),void 0===a&&(a="#wpstg-btn-provider-authenticate"),void 0===c&&(c="#wpstg-provider-authenticate-form"),void 0===l&&(l="wpstg-provider-authenticate"),void 0===u&&(u="#wpstg-btn-provider-test-connection"),void 0===g&&(g="#wpstg-provider-test-connection-fields"),void 0===d&&(d="wpstg-provider-test-connection"),void 0===p&&(p=wpstg),this.revokeButtonSelector=e,this.revokeForm=i(t),this.revokeAction=n,this.settingsButtonSelector=r,this.settingsForm=i(s),this.settingsAction=o,this.authenticateButtonSelector=a,this.authenticateForm=i(c),this.authenticateAction=l,this.testConnectionButtonSelector=u,this.testConnectionFields=i(g),this.testConnectionAction=d,this.wpstgObject=p,this.notyf=new Notyf({duration:2e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1},{type:"error",background:"#e01e5a",icon:!0}]}),this.init()}var n=e.prototype;return n.addEvents=function(){var e=this;a(document.body,"click",this.revokeButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendRevokeRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),a(document.body,"click",this.settingsButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendSettingsRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),a(document.body,"click",this.authenticateButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendAuthenticateRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),a(document.body,"click",this.testConnectionButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendTestConnectionRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),a(document.body,"change","[name='ftp_type']",function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.toggleSftpFields();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),a(document.body,"change","[name='s3_provider']",function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.toggleS3GenericFields();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())},n.init=function(){this.addEvents()},n.sendRevokeRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.revokeForm.querySelector('input[name="provider"]').value,e.prev=1,e.next=4,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.revokeAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,provider:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return(n=e.sent).ok||console.error("An error has occured: "+n.status),e.next=8,n.json();case 8:if(!(r=e.sent).success){e.next=13;break}return this.notyf.success(r.message),setTimeout((function(){window.location.reload()}),3e3),e.abrupt("return");case 13:this.notyf.error(r.message),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.warn(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}(),n.sendSettingsRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,r,s,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p,n=t.showModal(),(r=new FormData(this.settingsForm)).append("action",this.settingsAction),r.append("accessToken",this.wpstgObject.accessToken),r.append("nonce",this.wpstgObject.nonce),s=new URLSearchParams(r),e.prev=7,e.next=10,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 10:return(o=e.sent).ok||console.error("An error has occured: "+o.status),e.next=14,o.json();case 14:(i=e.sent).success||this.notyf.error(i.message),i.warning?this.notyf.open({type:"warning",message:i.message}):this.notyf.success(i.message),setTimeout((function(){window.location.reload()}),2e3),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(7),console.warn(e.t0);case 23:return e.prev=23,n.close(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[7,20,23,26]])})));return function(){return e.apply(this,arguments)}}(),n.sendAuthenticateRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData(this.authenticateForm)).append("action",this.authenticateAction),t.append("accessToken",this.wpstgObject.accessToken),t.append("nonce",this.wpstgObject.nonce),n=new URLSearchParams(t),e.prev=5,e.next=8,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return(r=e.sent).ok||console.error("An error has occured: "+r.status),e.next=12,r.json();case 12:if(!(s=e.sent).success){e.next=17;break}return this.notyf.success(s.message),setTimeout((function(){window.location.reload()}),2e3),e.abrupt("return");case 17:this.notyf.error(s.message),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn(e.t0);case 23:case"end":return e.stop()}}),e,this,[[5,20]])})));return function(){return e.apply(this,arguments)}}(),n.sendTestConnectionRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,r,s,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p,n=t.showModal(),r=this.testConnectionFields.querySelectorAll("[name]"),(s=new FormData).append("action",this.testConnectionAction),s.append("accessToken",this.wpstgObject.accessToken),s.append("nonce",this.wpstgObject.nonce),r.forEach((function(e){console.log(e),"check"!==e.type&&"checkbox"!==e.type?s.append(e.getAttribute("name"),e.value):s.append(e.getAttribute("name"),e.checked)})),o=new URLSearchParams(s),e.prev=9,e.next=12,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 12:return(i=e.sent).ok||console.error("An error has occured: "+i.status),e.next=16,i.json();case 16:if(!(a=e.sent).success){e.next=20;break}return this.notyf.success(a.message),e.abrupt("return");case 20:this.notyf.error(a.message),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(9),console.warn(e.t0);case 26:return e.prev=26,n.close(),e.finish(26);case 29:case"end":return e.stop()}}),e,this,[[9,23,26,29]])})));return function(){return e.apply(this,arguments)}}(),n.toggleSftpFields=function(){var e=document.querySelector("[name='ftp_type']"),t=document.querySelectorAll(".only-sftp"),n=document.querySelectorAll(".only-ftp");if("ftp"!==e.value){if(t.length)for(var s,o=r(t);!(s=o()).done;){s.value.classList.remove("hidden")}if(n.length)for(var i,a=r(n);!(i=a()).done;){i.value.classList.add("hidden")}}else{if(t.length)for(var c,l=r(t);!(c=l()).done;){c.value.classList.add("hidden")}if(n.length)for(var u,g=r(n);!(u=g()).done;){u.value.classList.remove("hidden")}}},n.toggleS3GenericFields=function(){var e=""===document.querySelector("[name='s3_provider']").value;document.getElementById("wpstg-s3-custom-provider-fields").style.display=e?"block":"none"},e}(),w=function(){function e(e,t,n,r){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t="#wpstg-workflow"),void 0===n&&(n=wpstg),void 0===r&&(r=null),this.directoryListingContainer=i(e),this.workflow=i(t),this.wpstgObject=n,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=r,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(a(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),a(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,n){n.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),a(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),a(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),a(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,n){n.preventDefault(),e.toggleDirectoryNavigation(t)})),a(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: directory navigation add events")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){return this.currentParentDiv=e.parentElement,this.currentCheckboxElement=e.previousSibling,this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigateable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:this.currentCheckboxElement.value,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(n),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void c(n)}null!==t.notyf?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):alert("Error: "+t.wpstgObject.i18n.somethingWentWrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},t.getExcludedDirectories=function(){var e=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir input:not(:checked)").forEach((function(t){e.isParentExcluded(t.value)||e.excludedDirectories.push(t.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(t){e.isParentExcluded(t)||e.isScanned(t)||e.excludedDirectories.push(t)})),this.excludedDirectories.join(this.wpstgObject.settings.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(n){e.startsWith(n+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t=i("#wpstg_extraDirectories");if(null===t||""===t.value)return e.join(this.wpstgObject.settings.directorySeparator);var n=t.value.split(/\r?\n/);return e.concat(n).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir>input").forEach((function(n){n.value==e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=e.previousSibling;if("false"!==t.getAttribute("data-navigateable","false")&&"false"!==t.getAttribute("data-scanned","false")){var n=function(e,t){for(var n=e.nextElementSibling;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(e,".wpstg-subdir");"none"===n.style.display?c(n):function(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}(n)}},t.updateDirectorySelection=function(e){var t=e.parentElement;e.setAttribute("data-changed","true"),e.checked?(l(t,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg-check-dir")&&(e.children[t].checked=!0)})),t.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[data-content-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[data-content-type="plugin"]:checked').length,n=i("#wpstg-files-count");0===e&&0===t?(n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.noFileSelected):(n.classList.remove("danger"),n.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",e).replace("{p}",t))},e}(),f=function(){function e(){this.generateLoginLink()}return e.prototype.generateLoginLink=function(){var e=new Notyf({duration:4e3,position:{x:"center",y:"bottom"},dismissible:!0});a(document.body,"click",".wpstg-generate-login-link-action",(function(e){WPStaging.ajax({action:"wpstg_render_login_link_user_interface",clone:e.getAttribute("data-clone"),cloneName:e.getAttribute("data-name"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){i("#wpstg-workflow").innerHTML=e}),"HTML")})),a(document.body,"click","#wpstg-generate-login-link",(function(t){var n="<p class='wpstg-push-confirmation-message'> "+t.getAttribute("data-alert-body")+"</p>";(function(e,t,n,r){return o.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:r+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})})(t.getAttribute("data-alert-title"),n,t.getAttribute("data-confirm-btn-text"),"wpstg-confirm-link-save").then((function(t){if(t.value){var n="#wpstg-generate-login-link-",r=i(n+"clone-id").value,s=i(n+"role").value,o=i(n+"minutes").value,a=i(n+"hours").value,c=i(n+"days").value,l=i(n+"generated").getAttribute("data-url"),u=Date.now().toString();WPStaging.ajax({action:"wpstg_save_generated_link_data",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:r,role:s,minutes:o,hours:a,days:c,uniqueid:u},(function(t){t.success?(i("#wpstg-generate-login-link-head").style.display="",i("#wpstg-generate-login-link-generated").innerText=l+u,e.success(t.data.message)):e.error(t.data.message)}),"json")}}))})),a(document.body,"mouseover","#wpstg-generate-login-link-generated",(function(e){i("#wpstg-generate-login-link-copy-text").innerText=i("#wpstg-generate-login-link-copy-text").getAttribute("data-copy"),i("#wpstg-generate-login-link-copy-text").style.display=""})),a(document.body,"mouseleave","#wpstg-generate-login-link-generated",(function(e){i("#wpstg-generate-login-link-copy-text").style.display="none"})),a(document.body,"click","#wpstg-generate-login-link-generated",(function(e){navigator.clipboard.writeText(e.innerHTML),i("#wpstg-generate-login-link-copy-text").innerText=i("#wpstg-generate-login-link-copy-text").getAttribute("data-copied")}))},e}(),m=function(){function e(){this.syncAccount()}var t=e.prototype;return t.syncAccount=function(){var e=this;a(document.body,"click",".wpstg-sync-account",(function(t){var n=i(".wpstg-sync-account").dataset,r="<p class='wpstg-push-confirmation-message'> "+n.alertBody+"</p>";e.confirmModal(n.alertTitle,r,n.confirmBtnText,"wpstg-confirm-sync-account").then((function(e){var t=n.clone;e.value&&WPStaging.ajax({action:"wpstg_sync_account",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:t},(function(e){e.data.message&&(e.success?o.showSuccessModal(e.data.message):o.showErrorModal(e.data.message))}),"json",!1)}))}))},t.confirmModal=function(e,t,n,r){return o.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:r+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})},e}(),b=function(e){var t={isCancelled:!1,isFinished:!1,getLogs:!1,tableSelector:null,fileSelector:null,directoryNavigator:null,notyf:null},n={elements:[],get:function(t){return-1!==e.inArray(t,n.elements)||(n.elements[t]=jQuery(t)),n.elements[t]},refresh:function(e){e.elements[e]=jQuery(e)}},r=function(){WPStaging.ajax({action:"wpstg_cancel_push_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(e.success)return t.isCancelled=!0,n.get(".wpstg-loader").hide(),n.get("#wpstg-cancel-pushing").hide(),window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),void WPStaging.loadOverview()}),"json",!1)},s=function e(){n.get(".wpstg-loader").show(),n.get(".wpstg-log-details").show();var s=n.get("#wpstg-push-changes").data("clone"),o=n.get("#wpstg-delete-upload-before-pushing")[0].checked,u=!1;o&&(u=n.get("#wpstg-backup-upload-before-pushing")[0].checked);var g=a(),d=c(),p=!1;t.isCancelled=!1,g.length>d.length?g="":d.length>g.length&&(d="",p=""===g),WPStaging.ajax({action:"wpstg_push_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:s,includedTables:g,excludedTables:d,allTablesExcluded:p,selectedTablesWithoutPrefix:l(),includedDirectories:b(),excludedDirectories:v(),extraDirectories:y(),createBackupBeforePushing:n.get("#wpstg-create-backup-before-pushing")[0].checked,deletePluginsAndThemes:n.get("#wpstg-remove-uninstalled-plugins-themes")[0].checked,deleteUploadsBeforePushing:o,backupUploadsBeforePushing:u},(function(s){return t.isCancelled?(r(),n.get(".wpstg-loader").hide(),n.get("#wpstg-cancel-pushing").hide(),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):!1===s?(showError("Something went wrong! Error: No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==s.error&&s.error?(WPStaging.showError("Something went wrong! Error: "+s.message+".  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):(void 0!==s.last_msg&&s.last_msg&&WPStaging.getLogs(s.last_msg),void(!1===s.status?(k(s),setTimeout((function(){n.get(".wpstg-loader").show(),e()}),wpstg.delayReq)):!0===s.status?(k(s),e()):("finished"===s.status||void 0!==s.job_done&&s.job_done)&&(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),i(s))))}),"json",!1)},i=function(e){k(e),n.get(".wpstg-loader").hide(),n.get(".wpstg-prev-step-link").attr("disabled",!1),n.get("#wpstg-cancel-pushing").hide(),o.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width",popup:"wpstg-swal-popup wpstg-push-finished centered-modal"}).fire({title:"Push Successful!",icon:"success",html:"Clear the site cache if changes are not visible!",width:"500px",focusConfirm:!0})},a=function(){return null===t.tableSelector?"":t.tableSelector.getIncludedTables()},c=function(){return null===t.tableSelector?"":t.tableSelector.getExcludedTables()},l=function(){return null===t.tableSelector?"":t.tableSelector.getSelectedTablesWithoutPrefix()},p=function(e,t,n,r){return o.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:r+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})},b=function(){var t=[];return e(".wpstg-dir input:checked").each((function(){var n=e(this);n.parent(".wpstg-dir").parents(".wpstg-dir").children(".wpstg-expand-dirs").hasClass("disabled")||t.push(n.val())})),t},v=function(){var t=[];return e(".wpstg-dir input:not(:checked)").each((function(){var n=e(this);t.push(n.val())})),t},y=function(){var t=[];return e("#wpstg_extraDirectories").val()?t=e("#wpstg_extraDirectories").val().split(/\r?\n/):t},k=function(e,t){if(void 0===e.percentage)return!1;var r;("JobCreateBackup"===e.job&&(n.get("#wpstg-progress-backup").width(.15*e.percentage+"%").html(e.percentage+"%"),n.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 1 of 4 Creating backup...")),"jobFileScanning"===e.job||"jobCopy"===e.job)&&(n.get("#wpstg-progress-backup").css("background-color","#3bc36b"),n.get("#wpstg-progress-backup").html("1. Backup"),n.get("#wpstg-progress-backup").width("15%"),r="jobFileScanning"===e.job?e.percentage/2:50+e.percentage/2,n.get("#wpstg-progress-files").width(.3*r+"%").html(r.toFixed(0)+"%"),n.get("#wpstg-processing-status").html(r.toFixed(0)+"% - Step 2 of 4 Copying files..."));if("jobCopyDatabaseTmp"===e.job||"jobSearchReplace"===e.job||"jobData"===e.job){n.get("#wpstg-progress-files").css("background-color","#3bc36b"),n.get("#wpstg-progress-files").html("2. Files"),n.get("#wpstg-progress-files").width("30%");var s=0;s="jobCopyDatabaseTmp"===e.job?e.percentage/3:"jobSearchReplace"===e.job?100/3+e.percentage/3:200/3+e.percentage/3,n.get("#wpstg-progress-data").width(.4*s+"%").html(s.toFixed(0)+"%"),n.get("#wpstg-processing-status").html(s.toFixed(0)+"% - Step 3 of 4 Copying data...")}"jobDatabaseRename"===e.job&&(n.get("#wpstg-progress-data").css("background-color","#3bc36b"),n.get("#wpstg-progress-data").html("3. Data"),n.get("#wpstg-progress-data").width("40%"),n.get("#wpstg-progress-finishing").width(.15*e.percentage+"%").html(e.percentage+"%"),n.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 4 of 4 Finishing migration...")),"finished"===e.status&&(n.get("#wpstg-progress-finishing").css("background-color","#3bc36b"),n.get("#wpstg-progress-finishing").html("4. Finishing migration"),n.get("#wpstg-progress-finishing").width("15%"),n.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Pushing Process Finished"))};return t.init=function(){var o;n.get("#wpstg-workflow").on("click","#wpstg-push-changes",(function(e){e.preventDefault(),n.get(".wpstg-tabs-wrapper").hide(),n.get("#wpstg-push-changes").hide();var t=n.get("#wpstg-push-changes").data("clone-name");p("Confirm Push!","<p class='wpstg-push-confirmation-message'>This will overwrite the production/live site and its plugins, themes and media assets with data from the staging site: \""+t+'".  <br/><br/>Database data will be overwritten for each selected table. Take care if you use a shop system like WooCommerce and read the <a href="https://wp-staging.com/docs/skip-woocommerce-orders-and-products/" target="_blank">FAQ</a>. <br/><br/><b>Important:</b> Before you proceed make sure that you have a full site backup. If the pushing process is not successful contact us at <a href=\'mailto:support@wp-staging.com\'>support@wp-staging.com</a> or use the Contact Us button.</p>',"Push","wpstg-confirm-push").then((function(e){if(e.value)return n.get("#wpstg-push-changes").attr("disabled",!0),n.get(".wpstg-prev-step-link").attr("disabled",!0),n.get("#wpstg-scanning-files").hide(),n.get(".wpstg-progress-bar-wrapper").show(),n.get("#wpstg-cancel-pushing").show(),WPStaging.switchStep(3),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),void s();n.get(".wpstg-tabs-wrapper").show(),n.get("#wpstg-push-changes").show()}))})).on("click","#wpstg-cancel-pushing",(function(){if(!confirm("Are you sure you want to cancel pushing process?"))return!1;r()})),(o=n.get("#wpstg-workflow")).on("click",".wpstg-push-changes",(function(r){var s=this;WPStaging.checkUserDbPermissions("push").then((function(i){if(r.preventDefault(),e(s).attr("disabled"))return!1;o.addClass("loading");var a=e(s).data("clone");t.data={action:"wpstg_scan",clone:a,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(t.data,(function(e){e.length<1&&showError("Something went wrong! No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),o.removeClass("loading").html(e),WPStaging.switchStep(2),n.get(".wpstg-step3-cloning").hide(),n.get(".wpstg-step3-pushing").show(),n.get(".wpstg-loader").hide(),t.directoryNavigator=new w("#wpstg-scanning-files","#wpstg-workflow",wpstg,t.notyf),t.directoryNavigator.countSelectedFiles(),t.tableSelector=new g,t.fileSelector=new d,t.tableSelector.countSelectedTables(),t.fileSelector.countSelectedFiles()}),"HTML")}))})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-use-target-dir",(function(t){t.preventDefault(),e("#wpstg_clone_dir").val(this.getAttribute("data-path"))})).on("click","#wpstg-use-target-hostname",(function(t){t.preventDefault(),e("#wpstg_clone_hostname").val(this.getAttribute("data-uri"))})).on("change","#wpstg-delete-upload-before-pushing",(function(t){t.currentTarget.checked?e("#wpstg-backup-upload-container").show():(e("#wpstg-backup-upload-container").hide(),e("#wpstg-backup-upload-before-pushing").removeAttr("checked"))})),function(){var e=n.get("#wpstg-workflow");e.on("click","#wpstg-db-connect",(function(e){e.preventDefault(),n.get(".wpstg-loader").show(),n.get("#wpstg-db-status").hide(),WPStaging.ajax({action:"wpstg_database_connect",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:n.get("#wpstg_db_username").val(),databasePassword:n.get("#wpstg_db_password").val(),databaseServer:n.get("#wpstg_db_server").val(),databaseDatabase:n.get("#wpstg_db_database").val(),databasePrefix:n.get("#wpstg_db_prefix").val(),databaseSsl:n.get("#wpstg_db_ssl").is(":checked")},(function(e){return!1===e?(showError("Something went wrong! Error: No response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").remove(),n.get("#wpstg-error-details").hide(),void n.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-failed"> Failed</span>')):void 0!==e.errors&&e.errors?(WPStaging.showError("Something went wrong! Error: "+e.errors+" Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").hide(),n.get("#wpstg-db-error").remove(),void n.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-failed"> Failed</span><br/><span id="wpstg-db-error" class="wpstg--red">Error: '+e.errors+"</span>")):void(void 0!==e.success&&e.success&&(n.get(".wpstg-loader").hide(),n.get("#wpstg-db-status").hide(),n.get("#wpstg-error-details").hide(),n.get("#wpstg-db-error").hide(),n.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-success"> Success</span>')))}),"json",!1)})),e.on("click","#wpstg-ext-db",(function(){this.checked?(n.get("#wpstg_db_server").removeAttr("readonly"),n.get("#wpstg_db_username").removeAttr("readonly"),n.get("#wpstg_db_password").removeAttr("readonly"),n.get("#wpstg_db_database").removeAttr("readonly"),n.get("#wpstg_db_prefix").removeAttr("readonly"),n.get("#wpstg_db_ssl").removeAttr("readonly")):(n.get("#wpstg_db_server").attr("readonly",!0).val(""),n.get("#wpstg_db_username").attr("readonly",!0).val(""),n.get("#wpstg_db_password").attr("readonly",!0).val(""),n.get("#wpstg_db_database").attr("readonly",!0).val(""),n.get("#wpstg_db_prefix").attr("readonly",!0).val(""),n.get("#wpstg_db_ssl").attr("readonly",!0).prop("checked",!1))}))}(),function(){var r=n.get("#wpstg-workflow");r.on("click",".wpstg-edit-clone-data",(function(n){if(n.preventDefault(),e(this).attr("disabled"))return!1;var s=e(this).data("clone");t.data={action:"wpstg_edit_clone_data",clone:s,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(t.data,(function(e){r.html(e)}),"HTML")})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-save-clone-data",(function(e){e.preventDefault();var r="#wpstg-edit-clone-data-",s=n.get(r+"clone-id").val(),o=n.get(r+"clone-name").val(),i=n.get(r+"directory-name").val(),a=n.get(r+"path").val(),c=n.get(r+"url").val(),l=n.get(r+"prefix").val(),u=n.get(r+"database-user").val(),g=n.get(r+"database-password").val(),d=n.get(r+"database-database").val(),p=n.get(r+"database-server").val(),h=n.get(r+"database-prefix").val(),w=n.get(r+"database-ssl").is(":checked");t.data={action:"wpstg_save_clone_data",clone:s,cloneName:o,directoryName:i,path:a,url:c,prefix:l,externalDBUser:u,externalDBPassword:g,externalDBDatabase:d,externalDBHost:p,externalDBPrefix:h,externalDBSsl:w,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(t.data,(function(e){"Success"===e?WPStaging.loadOverview():alert(e)}),"HTML")}))}(),new u,new h,new f,new m},t}(jQuery);jQuery(document).ready((function(e){b.init(),jQuery(document).on("click","#wpstg-update-mail-settings",(function(t){t.preventDefault(),e("#wpstg-update-mail-settings").attr("disabled","disabled");var n={action:"wpstg_update_staging_mail_settings",emailsAllowed:e("#wpstg_allow_emails").is(":checked"),accessToken:wpstg.accessToken,nonce:wpstg.nonce};jQuery.ajax({url:ajaxurl,type:"POST",data:n,error:function(e,t,n){o.getSwalModal().fire("Unknown error","Please get in contact with us to solve it support@wp-staging.com","error")},success:function(t){var n="error";return t.success&&(n="success"),o.getSwalModal().fire("",t.message,n).then((function(){jQuery(".wpstg-mails-notice").slideUp("fast")})),e("#wpstg-update-mail-settings").removeAttr("disabled"),!0},statusCode:{404:function(){o.getSwalModal().fire("404","Something went wrong; can't find ajax request URL! Please get in contact with us to solve it support@wp-staging.com","error")},500:function(){o.getSwalModal().fire("500","Something went wrong; internal server error while processing the request! Please get in contact with us to solve it support@wp-staging.com","error")}}})}))}))}();
//# sourceMappingURL=wpstg-admin-pro.min.js.map
